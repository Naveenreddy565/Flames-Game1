<!DOCTYPE html>
<html>
<head>
  <title>FLAMES Game</title>
  <style>
    #resultImage {
      display: none;
      margin-top: 10px;
      width: 200px; /* adjust size */
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <h1>FLAMES Game</h1>
  <input type="text" id="name1" placeholder="First Name">
  <input type="text" id="name2" placeholder="Second Name">
  <button id="go">Check Relationship</button>
  <p id="result"></p>
  <img id="resultImage" src="https://media.makeameme.org/created/hey-idiot-go.jpg" alt="Funny Meme">

  <script>
    window.onload = function() {
      function playFlames() {
        // 1. Get names
        const rawName1 = document.getElementById('name1').value || '';
        const rawName2 = document.getElementById('name2').value || '';

        // 2. Clean names
        let n1 = rawName1.toLowerCase().replace(/\s+/g, '');
        let n2 = rawName2.toLowerCase().replace(/\s+/g, '');

        // 3. Remove common letters
        for (const ch of [...n1]) {
          if (n2.includes(ch)) {
            n1 = n1.replace(ch, '');
            n2 = n2.replace(ch, '');
          }
        }

        // 4. Count remaining letters
        let count = n1.length + n2.length;
        if (count === 0) {
          document.getElementById('result').innerText = "All letters matched! Enter different names.";
          document.getElementById('resultImage').style.display = "none";
          return;
        }

        // 5. FLAMES logic
        let flames = ['F','L','A','M','E','S'];
        let idx = 0;
        while (flames.length > 1) {
          idx = (idx + count - 1) % flames.length;
          flames.splice(idx, 1);
        }

        const resultMap = {
          F: "Friendship",
          L: "Love",
          A: "Affection",
          M: "Marriage",
          E: "Enemy",
          S: "Sibling"
        };
        const result = resultMap[flames[0]];

        // 6. Display result
        document.getElementById('result').innerText = `Relationship: ${result}`;
        document.getElementById('resultImage').style.display = "block"; // show image

        // 7. Send data to Vercel serverless function
        console.log("Sending to Vercel:", { rawName1, rawName2, name1: n1, name2: n2, result });
        fetch('/api/log', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ rawName1, rawName2, name1: n1, name2: n2, result })
        })
        .then(res => res.json())
        .then(data => console.log("Vercel response:", data))
        .catch(err => console.error('Logging failed', err));
      }

      // Attach event listener AFTER page loads
      document.getElementById('go').addEventListener('click', playFlames);
    };
  </script>
</body>
</html>
