<!DOCTYPE html>
<html>
<head>
  <title>FLAMES Game</title>
</head>
<body>
  <h1>FLAMES Game</h1>
  <input type="text" id="name1" placeholder="First Name">
  <input type="text" id="name2" placeholder="Second Name">
  <button id="go">Check Relationship</button>
  <p id="result"></p>

  <script>
    function playFlames() {
      // 1. Get names
      const rawName1 = document.getElementById('name1').value || '';
      const rawName2 = document.getElementById('name2').value || '';

      // 2. Clean names
      let n1 = rawName1.toLowerCase().replace(/\s+/g, '');
      let n2 = rawName2.toLowerCase().replace(/\s+/g, '');

      // 3. Remove common letters
      for (const ch of [...n1]) {
        if (n2.includes(ch)) {
          n1 = n1.replace(ch, '');
          n2 = n2.replace(ch, '');
        }
      }

      // 4. Count remaining letters
      let count = n1.length + n2.length;

      if (count === 0) {
        document.getElementById('result').innerText = "All letters matched! Enter different names.";
        return;
      }

      // 5. FLAMES logic (corrected)
      let flames = ['F','L','A','M','E','S'];
      let idx = 0;

      while (flames.length > 1) {
        // calculate index for removal
        idx = (idx + count - 1) % flames.length;
        flames.splice(idx, 1);
      }

      const resultMap = {
        F: "Friendship",
        L: "Love",
        A: "Affection",
        M: "Marriage",
        E: "Enemy",
        S: "Sibling"
      };

      const result = resultMap[flames[0]];

      // 6. Display result
      document.getElementById('result').innerText = `Relationship: ${result}`;

      // 7. Send names + result to Vercel serverless function
      fetch('/api/log', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          rawName1,
          rawName2,
          name1: n1,
          name2: n2,
          result
        })
      }).catch(err => console.error('Logging failed', err));
    }

    document.getElementById('go').addEventListener('click', playFlames);
  </script>
</body>
</html>
